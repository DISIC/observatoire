<?xml version="1.1" encoding="UTF-8"?>

<!--
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
-->

<xwikidoc version="1.3" reference="Publication.Status" locale="">
  <web>Publication</web>
  <name>Status</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <creator>xwiki:XWiki.Admin</creator>
  <creationDate>1533213667000</creationDate>
  <parent>Main.WebHome</parent>
  <author>xwiki:XWiki.Admin</author>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <date>1533220935000</date>
  <contentUpdateDate>1533219179000</contentUpdateDate>
  <version>1.1</version>
  <title>Status</title>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>true</hidden>
  <content>{{groovy}}

class FileDateComparator implements Comparator {
  public int compare(Object o1, Object o2) {
    if (((File)o1).lastModified() &gt; ((File)o2).lastModified()) {
      return -1
    } else if (((File)o1).lastModified() &lt; ((File)o2).lastModified()) {
      return +1
    } else {
      return 0
    }
  }
}
  
def permanentDirectory = services.component.getInstance(org.xwiki.environment.Environment.class).getPermanentDirectory()
def publicationDirectory = new File("$permanentDirectory/jobs/status/publication/")
def jobDirectories = publicationDirectory.listFiles()
Arrays.sort(jobDirectories, new FileDateComparator())
def jobId = request.jobId
  
println "{{html}}"

println "&lt;form name=\"job-status\" action=\"\" method=\"POST\"&gt;"
println "Job ID:"
println "&lt;select name=\"jobId\"&gt;"
  
for (file in jobDirectories) {
  def fileName = file.name
  def selected = ""
  if (jobId != null &amp;&amp; fileName.equals(jobId))
    selected = "selected"
  println "&lt;option value=\"$fileName\" $selected&gt;$fileName&lt;/option&gt;"
}

println "&lt;/select&gt;"
println "&lt;input type='submit' value='Submit' class='btn btn-primary'&gt;"
println "&lt;/form&gt;"
println "\n{{/html}}\n"
  
if (jobId != null &amp;&amp; jobId.indexOf("/") &lt; 0) {
  println "\n{{jobprogress jobid=\"publication/${jobId}\" /}}\n"  
}
  
{{/groovy}}
</content>
</xwikidoc>
