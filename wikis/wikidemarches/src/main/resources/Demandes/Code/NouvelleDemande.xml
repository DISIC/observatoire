<?xml version='1.1' encoding='UTF-8'?>
<xwikidoc version="1.3" reference="Demandes.Code.NouvelleDemande" locale="">
  <web>Demandes.Code</web>
  <name>NouvelleDemande</name>
  <language/>
  <defaultLanguage>fr</defaultLanguage>
  <translation>0</translation>
  <creator>xwiki:XWiki.slauriere</creator>
  <creationDate>1528882614000</creationDate>
  <parent>Main.Search</parent>
  <author>xwiki:XWiki.slauriere</author>
  <contentAuthor>xwiki:XWiki.slauriere</contentAuthor>
  <date>1528892080000</date>
  <contentUpdateDate>1528892080000</contentUpdateDate>
  <version>2.16</version>
  <title>Émettre une demande</title>
  <comment/>
  <minorEdit>true</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>false</hidden>
  <content>{{velocity output="true"}}&#xd;
## only if something was submitted to this page, save&#xd;
#if ("$!request['save-demande']" != '')&#xd;
  #set ($uin = $services.uin.next)&#xd;
  ## get avis document with programming rights, otherwise we might have trouble getting this new document when we'll setup rights&#xd;
  #set ($target = $xwiki.getDocumentAsAuthor("Demandes.${uin}"))&#xd;
  #set ($content = $request.content)&#xd;
  #set ($object = $target.addObjectFromRequest('Demandes.Code.DemandesClass'))&#xd;
  #set ($discard = $target.setContent($content))&#xd;
  ## save with programming rights as the current user will not have the right to edit the Avis document&#xd;
  #set ($discard = $target.saveWithProgrammingRights())&#xd;
  ##TODO: see how we handle an error in saving the object&#xd;
  $request.session.setAttribute('demande-handler-operation-message', 'wikidemarches.demande.merci')&#xd;
#end&#xd;
&#xd;
#macro (displayMessage $key)&#xd;
{{success}}&#xd;
  $services.localization.render($key)&#xd;
{{/success}}&#xd;
#end&#xd;
{{/velocity}}&#xd;
&#xd;
{{velocity}}&#xd;
{{html wiki="true"}}&#xd;
#set ($messageKey = $request.session.getAttribute('demande-handler-operation-message'))&#xd;
#if ("$!messageKey" != '')&#xd;
  ## Clean the session and display the message.&#xd;
  #set ($discard = $request.session.removeAttribute('demande-handler-operation-message'))&#xd;
  #displayMessage($messageKey)&#xd;
#else&#xd;
  #set ($demande = $doc.newObject('Demandes.Code.DemandesClass'))&#xd;
  &lt;form action="$doc.getURL()" method="POST" class="xform demande-form">&#xd;
  &lt;fieldset class="form-staticlistclass">&#xd;
    &lt;label for="Demandes.Code.DemandesClass_0_type">Type de demande&lt;/label>&#xd;
    &lt;div>&#xd;
      &lt;select id="Demandes.Code.DemandesClass_0_type" name="Demandes.Code.DemandesClass_0_type" size="1">&#xd;
        &lt;option aria-required="true" label="Demande de dématérialisation" value="dematerialisation">Demande de dématérialisation&lt;/option>&#xd;
        &lt;option aria-required="true" label="Demande de contact" value="contact">Demande de contact&lt;/option>&#xd;
      &lt;/select>&#xd;
      &lt;input name="Demandes.Code.DemandesClass_0_type" type="hidden" value="">&#xd;
    &lt;/div>&#xd;
  &lt;/fieldset>&#xd;
  &lt;fieldset class="form-computedfieldclass">&#xd;
    &lt;label for="Demandes.Code.DemandesClass_0_contenu">Contenu de la demande&lt;/label>&#xd;
    &lt;div>&#xd;
        &lt;textarea aria-required="true" cols="80" id="Demandes.Code.DemandesClass_0_contenu" name="content" rows="10">&lt;/textarea>&#xd;
    &lt;/div>&#xd;
  &lt;/fieldset>&#xd;
  &lt;div class="buttonwrapper">&#xd;
    &lt;input class="button btn btn-primary" name="save-demande" type="submit" value="Envoyer">&#xd;
  &lt;/div>&#xd;
&lt;/form>&#xd;
&#xd;
&#xd;
#end&#xd;
{{/html}}&#xd;
{{/velocity}}&#xd;
&#xd;
&#xd;
&#xd;
</content>
</xwikidoc>